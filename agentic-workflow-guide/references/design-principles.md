# Design Principles

エージェントワークフロー設計のための原則集。

## Tier 1: コア原則（必須）

### 1. SSOT (Single Source of Truth)

**情報は一箇所で管理する**

| 観点                     | 説明                                     |
| ------------------------ | ---------------------------------------- |
| **定義**                 | 同じ情報を複数箇所で定義しない           |
| **ワークフローでの適用** | コンテキスト、設定、状態は一元管理       |
| **違反例**               | 各エージェントが同じ設定を別々に持つ     |
| **対策**                 | 共有コンテキストまたは設定ファイルを使用 |

### 2. SRP (Single Responsibility Principle)

**1 エージェント = 1 責務**

| 観点                     | 説明                                                 |
| ------------------------ | ---------------------------------------------------- |
| **定義**                 | 各エージェントは 1 つの責務に集中                    |
| **ワークフローでの適用** | タスクを明確に分離して各エージェントに割り当て       |
| **違反例**               | 1 つのエージェントが「検索 + 分析 + 報告」を全て担当 |
| **対策**                 | 役割ごとにエージェントを分割                         |

### 3. Simplicity First

**最もシンプルな解から始める**

| 観点                     | 説明                                               |
| ------------------------ | -------------------------------------------------- |
| **定義**                 | 必要十分な複雑さに留める                           |
| **ワークフローでの適用** | まず単一エージェントで試す。複雑化は必要に応じて   |
| **違反例**               | 最初から 10 エージェントの複雑なワークフローを設計 |
| **対策**                 | 最小構成から段階的に拡張                           |

**Anthropic の推奨:**

> "Start with simple prompts, optimize them with comprehensive evaluation, and add multi-step agentic systems only when simpler solutions fall short."

### 4. Fail Fast

**早期検知・早期修正**

| 観点                     | 説明                                   |
| ------------------------ | -------------------------------------- |
| **定義**                 | エラーは早期に検知し、即座に対処       |
| **ワークフローでの適用** | 各ステップで検証し、問題があれば即停止 |
| **違反例**               | エラーを無視して最後まで処理を続行     |
| **対策**                 | Gate/Checkpoint を設置                 |

### 5. Iterative Refinement

**小さく作って繰り返し改善**

| 観点                     | 説明                                   |
| ------------------------ | -------------------------------------- |
| **定義**                 | 大きな変更より小さな改善を繰り返す     |
| **ワークフローでの適用** | MVP → 動作確認 → フィードバック → 改善 |
| **違反例**               | 全機能を一度に実装して最後にテスト     |
| **対策**                 | 1 タスクずつ実装・検証                 |

**関連パターン:** Evaluator-Optimizer

### 6. Feedback Loop

**各ステップで成果確認 → 調整**

| 観点                     | 説明                                         |
| ------------------------ | -------------------------------------------- |
| **定義**                 | 実行結果からフィードバックを得て次に活かす   |
| **ワークフローでの適用** | エージェント出力を評価し、必要に応じて再実行 |
| **違反例**               | 一方通行で結果を確認しない                   |
| **対策**                 | 評価ステップを組み込む                       |

**Anthropic の推奨:**

> "During execution, it's crucial for the agents to gain 'ground truth' from the environment at each step to assess its progress."

---

## Tier 2: 品質原則（推奨）

### 7. Transparency

**計画・進捗を明示的に見せる**

| 観点                     | 説明                                   |
| ------------------------ | -------------------------------------- |
| **定義**                 | 何をしているかを可視化する             |
| **ワークフローでの適用** | 各ステップの開始/終了、進捗を明示      |
| **違反例**               | ブラックボックスで何が起きているか不明 |
| **対策**                 | ログ、進捗表示、TodoWrite 使用         |

**Anthropic の推奨:**

> "Prioritize transparency by explicitly showing the agent's planning steps."

### 8. Gate/Checkpoint

**各ステップで検証ゲート**

| 観点                     | 説明                             |
| ------------------------ | -------------------------------- |
| **定義**                 | 次のステップに進む前に検証を行う |
| **ワークフローでの適用** | 品質基準を満たさなければ進まない |
| **違反例**               | 検証なしで全ステップを通過       |
| **対策**                 | 条件分岐で品質チェック           |

### 9. DRY (Don't Repeat Yourself)

**重複排除、再利用**

| 観点                     | 説明                                       |
| ------------------------ | ------------------------------------------ |
| **定義**                 | 同じロジックを繰り返さない                 |
| **ワークフローでの適用** | 共通処理はテンプレート化、プロンプト再利用 |
| **違反例**               | 各エージェントに同じプロンプトをコピペ     |
| **対策**                 | 共通プロンプトテンプレートを作成           |

### 10. ISP (Interface Segregation Principle)

**必要最小限のコンテキスト**

| 観点                     | 説明                                 |
| ------------------------ | ------------------------------------ |
| **定義**                 | 各エージェントに必要な情報だけを渡す |
| **ワークフローでの適用** | 過剰なコンテキストはノイズになる     |
| **違反例**               | 全エージェントに全情報を渡す         |
| **対策**                 | タスクに必要な情報のみ選別して渡す   |

### 11. Idempotency (冪等性)

**リトライしても安全**

| 観点                     | 説明                                       |
| ------------------------ | ------------------------------------------ |
| **定義**                 | 同じ操作を複数回実行しても結果が変わらない |
| **ワークフローでの適用** | 失敗時にリトライできる設計                 |
| **違反例**               | リトライするとデータが重複                 |
| **対策**                 | 状態チェック、ユニーク ID 使用             |

---

## Tier 3: スケール原則（発展）

### 12. Human-in-the-Loop

**重要ポイントで人間確認**

| 観点                     | 説明                                 |
| ------------------------ | ------------------------------------ |
| **定義**                 | 自動化と人間判断のバランス           |
| **ワークフローでの適用** | 重要な決定、リスクの高い操作前に確認 |
| **適用例**               | 本番デプロイ前、大量削除前           |

### 13. KISS (Keep It Simple, Stupid)

**シンプルに保つ**

| 観点                     | 説明                                     |
| ------------------------ | ---------------------------------------- |
| **定義**                 | 不必要な複雑さを避ける                   |
| **ワークフローでの適用** | 必要十分なエージェント数、シンプルな連携 |

### 14. Loose Coupling

**エージェント間の疎結合**

| 観点                     | 説明                             |
| ------------------------ | -------------------------------- |
| **定義**                 | エージェント間の依存を最小化     |
| **ワークフローでの適用** | 各エージェントは独立して動作可能 |
| **メリット**             | 変更の影響範囲を限定、テスト容易 |

### 15. Graceful Degradation

**部分障害でも動作継続**

| 観点                     | 説明                                       |
| ------------------------ | ------------------------------------------ |
| **定義**                 | 一部が失敗しても全体は機能を維持           |
| **ワークフローでの適用** | フォールバック処理、スキップ可能なステップ |

---

## ACI Design (Agent-Computer Interface)

**Anthropic の推奨:**

> "Think about how much effort goes into human-computer interfaces (HCI), and plan to invest just as much effort in creating good agent-computer interfaces (ACI)."

### ツール設計のポイント

1. **明確な説明** - ツールの目的と使い方を明確に
2. **エッジケース** - 境界条件を文書化
3. **入力フォーマット** - 期待する入力形式を明示
4. **エラーハンドリング** - 失敗時の動作を定義
5. **テスト** - 実際に使ってみてイテレート

---

## References

- [Building Effective Agents - Anthropic](https://www.anthropic.com/engineering/building-effective-agents)
- [SOLID Principles](https://en.wikipedia.org/wiki/SOLID)
- [12-Factor App](https://12factor.net/)
